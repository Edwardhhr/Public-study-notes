# Windows远程桌面与默认RDP端口修改

任务描述：将Windows远程桌面默认端口修改为其他端口，防止端口扫描攻击  

### 安装远程桌面服务
1. 专业版Windows中打开“控制面板”->“程序”->“程序和功能”->“启用或关闭Windows功能”->勾选“**远程桌面服务**”->点击“确定”->等待安装完成
2. 如果是Windows Server 2016，需要安装“远程桌面服务”的“角色和功能”->“添加角色和功能”->“远程桌面服务”->“角色服务”->勾选“**远程桌面会话主机**”和“远程桌面授权”->点击“下一步”->等待安装完成

### 创建远程用户
1. 右键“此电脑”->“管理”->“本地用户和组”->“用户”->右键“新建用户”
2. 输入用户名和密码，勾选“用户不能更改密码”和“密码永不过期”，点击“创建”
3. 在隶属于中添加“Remote Desktop Users”组，点击“确定”（为了保障安全性如果仅需要远程桌面访问的权限可以删除Users组）

### 开启远程桌面服务
1. 右键“此电脑”->“属性”->“高级系统设置”->“远程”->“远程桌面”->勾选“允许远程连接到此计算机”->点击“确定”
2. 如果不放心可以检查一下，右键“此电脑”->“属性”->“高级系统设置”->“远程”->“远程桌面”->“选择用户”中是否有你创建的远程连接用户

### 设置远程桌面策略
1. “Win+R”打开“运行”->输入“gpedit.msc”打开“本地组策略编辑器”->“计算机配置”->“Windows设置”->“安全设置”->“本地策略”->“**用户权限分配**”->双击“**拒绝本地登陆**”->“添加用户或组”->添加你创建的远程连接用户->点击“确定”（这里实现了拒绝远程账户的本地登陆）
2. 在“本地组策略编辑器”->“计算机配置”->“Windows设置”->“安全设置”->“本地策略”->“用户权限分配”->双击“**从远程系统强制关机**”->**删除远程账户的远程关机权限**（这里实现了远程远程账户无法从远程强制关机）
3. 在“本地组策略编辑器”->“计算机配置”->“管理模板”->“Windows组件”->“远程桌面服务”->“远程桌面会话主机”->“**远程会话环境**”->双击“**从‘关机’对话框删除‘断开连接’选项**”->选中“**已启用**”->点击“确定”（这里实现了移除远程桌面会话中的“断开连接”选项）
4. 在“本地组策略编辑器”->“计算机配置”->“管理模板”->“Windows组件”->“远程桌面服务”->“远程桌面会话主机”->“**会话时间限制**”->双击“**设置活动的远程桌面服务会话的时间限制**”->设置为“**未配置**”或“**已禁用**”即可（这里实现了允许会话无时间限制地保持活动状态）

## 修改默认RDP端口
### 修改注册表
1. 打开注册表编辑器按下“Win + R”组合键，打开“运行”对话框，输入 **regedit** 并回车  
2. 在注册表编辑器中，依次导航到以下路径并修改端口号：
```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\Tds\tcp
```
```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp
```
“Ctrl+F”在每个路径下找到名为 **PortNumber** 的项，双击打开后将默认值（3389）修改为新的端口号（建议选择 1024 到 65535 之间的未被占用端口），并确保选择“十进制”
3. 重启计算机或服务：修改完成后，重启计算机或通过 **services.msc** 重启“Remote Desktop Services”服务以使更改生效

### 修改防火墙规则
1. 打开“控制面板”->“系统和安全”->“Windows Defender 防火墙”->“高级设置”->“入站规则”->右键“入站规则”->“新建规则”->“端口”->“下一步”->选中TCP和“特定本地端口”->在“特定本地端口”中输入PortNumber中修改的端口号->“下一步”->“允许连接”->“下一步”->“三个选项都要勾选”->“下一步”->名称随便填写->点击“完成”
