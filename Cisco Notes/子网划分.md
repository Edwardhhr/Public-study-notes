# 子网划分详细讲解

### IP地址简介
IP指网际互连协议，Internet Protocol的缩写，是TCP/IP体系中的网络层协议。设计IP的目的是提高网络的可扩展性：一是解决互联网问题，实现大规模、异构网络的互联互通；二是分割顶层网络应用和底层网络技术之间的耦合关系，以利于两者的独立发展。根据端到端的设计原则，IP只为主机提供一种无连接、不可靠的、尽力而为的数据包传输服务。  
IP地址（Internet Protocol Address）是指互联网协议地址，又译为网际协议地址。  
IP地址是IP协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。  

IP地址的组成：IP地址是一个32位的二进制数，通常被分割为4个“八位二进制数”（四个字节）  
IP地址的分类：所有IP地址所在的网络划分为A,B,C,D,E五类，IP地址由网络ID（网络号）和主机ID（主机号）组成  


### IP地址类型
IP地址由两部分组成：网络ID和主机ID。网络ID用于标识网络，主机ID用于标识网络中的设备。
有类IP地址规划的缺陷：使用默认掩码的问题：地址范围过大或过小，导致IP地址的浪费！通过子网划分解决。  

![zwhf](https://github.com/user-attachments/assets/a96b6fec-979e-4576-8cb1-b85936f541c1)  

#### A类IP地址
范围：**1.0.0.0 到 126.255.255.255**
特点：1字节网络地址，3字节主机地址  
网络数量：126个（0和127保留）  
每个网络的主机数：大约1.6亿个  
默认**子网掩码：255.0.0.0**  
特殊地址：**127.0.0.1（回环地址，用于本地测试）**

#### B类IP地址
范围：**128.1.0.0 到 191.254.255.255**  
特点：2字节网络地址，2字节主机地址  
网络数量：16382个（128.0.0.0和191.255.255.255保留）  
每个网络的主机数：大约6.5万个  
默认**子网掩码：255.255.0.0**

#### C类IP地址
范围：**192.0.1.0 到 223.255.254.255**  
特点：3字节网络地址，1字节主机地址  
网络数量：超过200万个  
每个网络的主机数：254个  
默认**子网掩码：255.255.255.0**

#### D类地址
范围：**224.0.0.0 到 239.255.255.255**  
用途：多点广播（Multicast）

#### E类地址
范围：**240.0.0.0 到 254.255.255.254**  
用途：保留给将来使用

#### 特殊IP地址：
全零地址：0.0.0.0，表示当前主机。  
全一地址：255.255.255.255，表示当前子网的广播地址。

#### 私有地址范围
A类私有地址：**10.0.0.0 到 10.255.255.255**  
B类私有地址：**172.16.0.0 到 172.31.255.255**  
C类私有地址：**192.168.0.0 到 192.168.255.255**  


### 子网划分的基本概念
子网划分是**将一个较大的网络划分成若干个较小的网络**，以提高网络的效率和安全性。子网划分通常通过**借用**IP地址的一部分**主机位**来作为子网位实现。  

> [!Note]
**子网地址**和**网络地址**是同一个概念。它们都**表示一个网段的起始地址**，用于标识一个特定的网络范围**即网段**  
**判断是否处于同一网段是通过计算子网地（网络地址）是否相同来判断的**  
**子网划分后子网掩码相同但是网段不一定相同**  

#### 计算方法
**2^m = 向主机借位后产生的子网个数，m为所借的位数**  
**2^n-2 = 可用的主机IP数**  
**n为源主机位剔除被借位后的剩余位数**  
**-2的原因是因为每个子网中的网络号及广播号不可用**

### 子网划分的步骤
**1. 确定子网数量：**  
首先，你需要确定需要多少个子网。这将决定你需要借用多少位IP地址的主机部分作为子网部分。  

**2. 计算子网掩码：**  
子网掩码是用于确定IP地址中哪些位是网络位，哪些位是主机位的。  
例如，如果你有一个C类地址（默认子网掩码255.255.255.0），并且你需要**至少2个子网**（即至少是x.x.x.x/30否则主机无法使用当前的地址），你可能需要借用**1位作为子网位**（即x.x.x.x/25，这里的25是前面三段的8位加上借位的1位）  
计算方法：  
2^8 − 2^7 = **128** （借了1位）  
2^8 − 2^7 + 2^6 = **192** （借了2位）   
2^8 − 2^7 + 2^6 + 2^5 = **224** （借了3位）  
2^8 − 2^7 + 2^6 + 2^5 + 2^4 = **240** （借了4位）  
2^8 − 2^7 + 2^6 + 2^5 + 2^4 + 2^3 = **248** （借了5位）  
2^8 − 2^7 + 2^6 + 2^5 + 2^4 + 2^3 + 2^2 = **252** （借了6位）  
2^8 − 2^7 + 2^6 + 2^5 + 2^4 + 2^3 + 2^2 + 2^1 = **254** （借了7位）  
2^8 − 2^7 + 2^6 + 2^5 + 2^4 + 2^3 + 2^2 + 2^1 + 2^0 = **255** （借了8位）  
这将改变子网掩码为255.255.255.**128**（这里只借了1位）  

或者还不清楚可以看下面的计算方法：  
将子网掩码变为2进制  **255.255.255.0 = 11111111.11111111.11111111.00000000**  
这是255.255.255.0的2进制表示，其中1表示网络位，0表示主机位：  
11111111 | 11111111 | 11111111 | 00000000  
开始向主机位借位
11111111 | 11111111 | 11111111 | 10000000  
将上面的子网掩码拆分成四段，每段8位，然后计算2的幂次方（从2的0次方开始从右到左直到2的7次方），得到：  
从左到右每位分别为：
2^7 = **128**
2^6 = **64**
2^5 = **32**
2^4 = **16**
2^3 = **8**
2^2 = **4**
2^1 = **2**
2^0 = **1**
借位前的子网掩码为（/24）：  
128 + 64 + 32 + 16 + 8 + 4 + 2 + 1 | 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1 | 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1 | 0 + 0 + 0 + 0 + 0 + 0 + 0 + 0  
借位后的子网掩码为（/25）：  
128 + 64 + 32 + 16 + 8 + 4 + 2 + 1 | 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1 | 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1 | 128 + 0 + 0 + 0 + 0 + 0 + 0 + 0  

2^7 = **128** （借了1位）  
2^7 + 2^6 = **192** （借了2位）  
2^7 + 2^6 + 2^5 = **224** （借了3位）  
2^7 + 2^6 + 2^5 + 2^4 = **240** （借了4位）  
2^7 + 2^6 + 2^5 + 2^4 + 2^3 = **248** （借了5位）  
2^7 + 2^6 + 2^5 + 2^4 + 2^3 + 2^2 = **252** （借了6位）  
2^7 + 2^6 + 2^5 + 2^4 + 2^3 + 2^2 + 2^1 = **254** （借了7位）  
2^7 + 2^6 + 2^5 + 2^4 + 2^3 + 2^2 + 2^1 + 2^0 = **255** （借了8位）  

**3. 计算子网地址和广播地址：**  
**子网地址是每个子网的起始地址，而广播地址是每个子网的结束地址（子网地址和广播地址不能用作通信地址使用）**。  
子网地址可以通过将IP地址与子网掩码进行**逻辑AND（&即与操作）**操作得到。  
广播地址可以通过将子网地址的**主机部分**全部置为1得到。  
例如：192.168.1.13/25  
子网掩码：255.255.255.128  
子网地址：192.168.1.0  
IP地址转换为2进制：  
11111111 | 11111111 | 11111111 | 00001101  
子网掩码转换为2进制：  
11111111 | 11111111 | 11111111 | 10000000  
逻辑AND（上下对比相同用相同不同使用0）：  
11111111 | 11111111 | 11111111 | 00000000  

广播地址：192.168.1.127  
子网地址转换为2进制：  
11111111 | 11111111 | 11111111 | 00000000  
主机部分全部置为1：  
11111111 | 11111111 | 11111111 | 01111111  
64 + 32 + 16 + 8 + 4 + 2 + 1 = 127

例如：192.168.1.234/25  
子网掩码：255.255.255.128  
子网地址：192.168.1.128  
IP地址转换为2进制：  
11111111 | 11111111 | 11111111 | 11101010  
子网掩码转换为2进制：  
11111111 | 11111111 | 11111111 | 10000000  
逻辑AND（上下对比相同用相同不同使用0）：  
11111111 | 11111111 | 11111111 | 10000000  

广播地址：192.168.1.255  
子网地址转换为2进制：  
11111111 | 11111111 | 11111111 | 10000000  
主机部分全部置为1：  
11111111 | 11111111 | 11111111 | 11111111  
128 + 64 + 32 + 16 + 8 + 4 + 2 + 1 = 255

**4. 确定每个子网的可用主机地址范围：**  
每个子网的可用主机地址范围是**从子网地址的下一个地址开始，到广播地址的前一个地址结束（即子网地址+1 到 广播地址-1）**。  
***注：这里只借了一位主机位所以子网个数是2个，即2^1=2***
第一个子网：192.168.1.0/25  
子网地址：192.168.1.0  
广播地址：192.168.1.127  
可用主机地址范围：**192.168.1.1 - 192.168.1.126**

第二个子网：192.168.1.128/25  
子网地址：192.168.1.128  
广播地址：192.168.1.255  
可用主机地址范围：**192.168.1.129 - 192.168.1.254**
