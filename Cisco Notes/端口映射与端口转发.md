# 端口映射与端口转发

### 什么是端口映射
端口映射就是将公网IP地址和端口映射到内网中的特定设备和端口，**实现外部网络对内部网络资源的访问**。当用户访问外网IP的这个端口时，服务器自动将请求映射到对应局域网内部的机器上。  
如图实现将本地内网服务的端口映射到公网路由器的外部端口中从而实现外网对内网服务的访问：  


**打个比方**：  
我们在内网中有一台Web服务器，但是外网中的用户是没有办法直接访问该服务器的。于是我们可以在路由器上设置一个端口映射，只要外网用户访问路由器ip的80端口，那么路由器会把自动把流量转到内网Web服务器的80端口上。并且，在路由器上还存在一个Session，当内网服务器返回数据给路由器时，路由器能准确的将消息发送给外网请求用户的主机。在这过程中，路由器充当了一个反向代理的作用，他保护了内网中主机的安全。  


### 什么是端口转发
端口转发（Port forwarding），用于将进入某个IP地址和端口的数据包转发到另一个IP地址和端口。它通常用于**将外部网络的请求转发到内部网络中的特定设备和服务**。  
如图实现从本地计算机访问云服务器中的私网服务：  


**打个比方**：  
我们现在在内网中，是没有办法直接访问外网的。但是我们可以通过路由器的**NAT方式**访问外网。假如我们内网现在有100台主机，那么我们现在都是通过路由器的这一个公网IP和外网通信的。那么，当互联网上的消息发送回来时，路由器是怎么知道这个消息是给他的，而另外消息是给你的呢？这就要我们的**ip地址和路由器的端口进行绑定**了，这时，在路由器中就会有一个**内网ip和路由器端口对应的一张表**。当路由器的10000端口收到消息时，就知道把消息发送给他，而当20000端口收到消息时，就知道把消息发送给你。这就是端口转发，其转发一个端口收到的流量，给另一个主机。  

### 端口映射与端口转发的区别
**1.定义上的区别**：  
- 端口映射：  
定义：端口映射是一种将公网IP地址的某个端口与内网IP地址的某个端口建立固定映射关系的技术。它主要用于将外部网络的请求定向到内网中的特定设备和服务。  
重点：强调“映射”关系，即建立一个固定的、长期的端口对应关系。  
应用场景：常用于将内网服务（如Web服务器、FTP服务器、游戏服务器等）对外发布。  

- 端口转发：  
定义：端口转发是一种将进入某个IP地址和端口的数据包转发到另一个IP地址和端口的技术。它更侧重于数据包的“转发”过程。  
重点：强调“转发”行为，即动态地将数据包从一个端口转发到另一个端口。  
应用场景：常用于临时或动态的端口通信，例如远程桌面、VPN、SSH隧道等。  

**2.实现方式的区别**：  
- 端口映射：
通常配置在路由器或防火墙上，通过静态规则将公网端口映射到内网端口。  
映射关系是固定的，一旦配置完成，不会轻易改变。  
例如：将公网IP的80端口永久映射到内网Web服务器的80端口。  

- 端口转发：
可以配置在路由器、防火墙或专用的转发软件中。  
转发规则可以是动态的，根据流量或连接状态进行调整。  
例如：通过SSH端口转发，将本地端口转发到远程服务器的某个端口，用于访问内网资源。  

**3.应用场景的区别**：  
- 端口映射：
主要用于将内网服务对外发布，例如：  
Web服务器（HTTP/HTTPS）  
FTP服务器  
游戏服务器  
视频监控服务器  
这些场景通常需要长期稳定的映射关系。  

- 端口转发：
主要用于临时或动态的访问需求，例如：  
远程桌面（RDP）访问  
SSH隧道  
VPN连接  
动态端口转发（如SOCKS代理）  
这些场景通常需要灵活的转发规则，可能根据需要动态调整。  

**4.端口转发和端口映射的关系**：
- 相同点：
两者都基于NAT（网络地址转换）技术，通过修改数据包的IP地址和端口号来实现内外网通信。  
在某些情况下，端口转发和端口映射可以实现相同的功能，比如将外部请求转发到内网的特定服务。  
- 不同点：
端口映射更强调“映射关系”的建立，通常用于固定的服务发布。  
端口转发更强调“转发行为”，通常用于动态的、临时的通信需求。  
